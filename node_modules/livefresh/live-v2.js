#!/usr/bin/env node

var livereload = require('livereload');
var	fs = require('fs');
var	prompt = require('prompt');

var	path = require('path');
var chemin = path.dirname("./");

//console.log ( "path " + chemin);


server = livereload.createServer({exts: ['css']});
server.watch(chemin, chemin + "/**/*", chemin + "/**/**/*");



fs.readFile('index.html', 'utf8', function (err,data) {
	//console.log("err " + err);
	if (data){
	var scriptReload = '<script src="//localhost:35729/livereload.js"></script>';
	//console.log("msg " + data.search(scriptReload) );
	if (data.search(scriptReload)<0){
		data = data = data.replace('</body>', scriptReload + '</body>');

		fs.writeFile('index.html', data, function (err) {
			if (err) throw err;
				console.log('I add a link in your code too !');
		});

	}


	}


});

console.log('Do you want i create a webserver for you ? (y/n)');

prompt.start();
prompt.get(['response'], function (err, result) {

	//console.log('response : ' + result.response);

	if (result.response ==="y"){

var connect = require('connect');
var serveStatic = require('serve-static');
connect().use(serveStatic(chemin)).listen(8080);
//console.log('You can use your page here : http://localhost:8080/ ');
//console.log('__dirname ' + __dirname);
var childProc = require('child_process');
childProc.exec('open -a "Google Chrome" http://localhost:8080/index.html');

	}

});


// console.log('I watching your files for refresh your webpage !!!!');